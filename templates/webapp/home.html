{% extends 'webapp/base.html' %}
{% load static %}

{% block title_block %}
Home
{% endblock %}

{% block body_block %}
<div class="welcome-msg">
  {% if user.is_authenticated %}
    <h2>Welcome back, {{ user.username }}!</h2>
  {% else %}
    <h2>Welcome to EventConnect</h2>
  {% endif %}
</div>

<section class="search-section">
  <h3>Find Events</h3>
  <form method="GET" action="{% url 'webapp:search_event_redirect' %}" class="search-form">
    <input type="text" id="searchInput" name="search_term" placeholder="Search for events..." autocomplete="off">
    <div id="autocomplete-results" class="autocomplete-box"></div>

    <select name="category_filter" id="category-select">
      <option value="">All Categories</option>
      {% for category in all_categories %}
        <option value="{{ category.name }}">{{ category.name }}</option>
      {% endfor %}
    </select>

    <button type="submit">Search</button>
  </form>
</section>

<section class="events-section">
  <h3>Popular Events</h3>
  {% if events %}
    <div class="event-grid">
      {% for event in events|slice:":4" %}
        <a href="{% url 'webapp:event_detail' event.id %}" class="event-card-link">
          <div class="event-card" style="background-image: url('{% if event.event_image %}{{ event.event_image.url }}{% endif %}');">
            <h4>{{ event.title }}</h4>
            <p><strong>{{ event.date|date:"Y-m-d H:i" }}</strong></p>
            <p class="event-location">{{ event.location }}</p>
          </div>
        </a>
      {% endfor %}
    </div>
  {% else %}
    <p>No events available.</p>
  {% endif %}
</section>

<section class="events-section">
  <h3>Recently Added</h3>
  {% if events %}
    <div class="event-grid">
      {% for event in events|slice:":4" %}
        <a href="{% url 'webapp:event_detail' event.id %}" class="event-card-link">
          <div class="event-card" style="background-image: url('{% if event.event_image %}{{ event.event_image.url }}{% endif %}');">
            <h4>{{ event.title }}</h4>
            <p><strong>{{ event.date|date:"Y-m-d H:i" }}</strong></p>
            <p class="event-location">{{ event.location }}</p>
          </div>
        </a>
      {% endfor %}
    </div>
  {% else %}
    <p>No recent events.</p>
  {% endif %}
</section>

<section class="category-section">
  <h3>Main Categories</h3>
  <div class="category-list">
    {% for category in main_categories %}
      <a href="{% url 'webapp:categories' category_name=category.name %}" class="category-chip-link">
        <div class="category-chip">
          {{ category.name|title }}
        </div>
      </a>
    {% endfor %}
  </div>
  <div class="more-categories-link">
    <a href="{% url 'webapp:more_categories' %}">View More Categories â†’</a>
  </div>
</section>
{% endblock %}


